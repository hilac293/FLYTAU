<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>פתיחת חשבון</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='register.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>

<div class="page">

    <h1>פתיחת חשבון</h1>
    <p class="subtitle">כמה פרטים קצרים ונוכל להמשיך להזמנה</p>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(category_filter=["error"]) %}
      {% if messages %}
        <div class="error-message">
          {{ messages[0] }}
        </div>
      {% endif %}
    {% endwith %}

    <form action="/register" method="post" class="form">

        <!-- English names (allowing multiple words) -->
        <input type="text" name="first_name" placeholder="שם פרטי (באנגלית)"
               pattern="[A-Za-z ]+" title="נא למלא באנגלית בלבד" required
               value="{{ prev_data.first_name if prev_data else '' }}">
        <input type="text" name="last_name" placeholder="שם משפחה (באנגלית)"
               pattern="[A-Za-z ]+" title="נא למלא באנגלית בלבד" required
               value="{{ prev_data.last_name if prev_data else '' }}">

        <!-- Email -->
        <input type="email" name="email" placeholder="אימייל" required
               pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"
               title="נא למלא כתובת מייל חוקית באנגלית בלבד"
               value="{{ prev_data.email if prev_data else '' }}">

        <!-- Phone numbers -->
        <div class="field">
            <i class="fa-solid fa-phone"></i>
            <input type="tel"
                   name="phone_1"
                   placeholder="מספר טלפון"
                   pattern="\d{10}"
                   title="טלפון חייב להיות 10 ספרות רצופות"
                   required
                   value="{{ prev_data.phone_1 if prev_data else '' }}">
        </div>

        <div class="field">
            <i class="fa-solid fa-phone"></i>
            <input type="tel"
                   name="phone_2"
                   placeholder="מספר טלפון נוסף (אופציונלי)"
                   pattern="\d{10}"
                   title="טלפון חייב להיות 10 ספרות רצופות"
                   value="{{ prev_data.phone_2 if prev_data else '' }}">
        </div>

        <!-- Passport number -->
        <input type="text" name="passport" placeholder="מספר דרכון"
               pattern="[A-Za-z0-9]{6,9}"
               title="מספר דרכון חייב להכיל 6-9 ספרות ואותיות בלבד"
               required
               value="{{ prev_data.passport if prev_data else '' }}">

        <!-- Birth date -->
        <input type="text" id="birth_date" name="birth_date" placeholder="תאריך לידה" required
               value="{{ prev_data.birth_date if prev_data else '' }}">

        <!-- Flatpickr JS -->
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <script src="https://npmcdn.com/flatpickr/dist/l10n/he.js"></script>
        <script>
            flatpickr("#birth_date", {
                "locale": "he",          // עברית
                dateFormat: "Y-m-d",     // פורמט תאריך למסד
                maxDate: "today",        // לא ניתן לבחור תאריכים עתידיים
                altInput: true,          // תצוגה קריאה למשתמש
                altFormat: "d/m/Y"       // פורמט לקריאה נוחה
            });
        </script>

        <!-- Password -->
        <input type="password" id="password" name="password"
               placeholder="סיסמה (באנגלית, לפחות 6 תווים, אותיות ומספרים)"
               pattern="(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,}"
               title="סיסמה חייבת להכיל לפחות 6 תווים, אותיות באנגלית ומספרים"
               required>

        <!-- Password confirmation -->
        <input type="password" id="confirm_password" name="confirm_password"
               placeholder="אימות סיסמה" required>
        <p id="password_error" class="error"></p>

        <button type="submit">צור חשבון</button>

    </form>

</div>

</body>
</html>
